<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üéûÔ∏è‡∏î‡∏π‡∏Ñ‡∏•‡∏¥‡∏õ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ</title>
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/128/2065/2065224.png">
    <style>
        * {
            box-sizing: border-box;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        body,
        html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
            /* Force pitch black base to hide any rounding artifacts */
            background: #000 !important;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        /* Aurora Background Effect (Default) */
        body::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 15% 50%, rgba(0, 255, 127, 0.1), transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(200, 50, 255, 0.1), transparent 25%);
            filter: blur(50px);
            z-index: 0;
            animation: auroraMove 15s infinite alternate;
            transition: opacity 1s ease;
            pointer-events: none;
        }

        /* Beat Mode Override (Triggered when sound is ON) */
        body.beat-mode::before {
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at center,
                    #000000 0%,
                    #1a0505 20%,
                    #250000 40%,
                    #1a0505 70%,
                    #000000 100%);
            filter: blur(40px);
            animation: syncedBeat 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite;
        }

        body::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            z-index: 1;
            pointer-events: none;
            transition: background 0.5s ease;
        }

        body.beat-mode::after {
            background: radial-gradient(circle at center, rgba(255, 0, 0, 0.2), transparent 70%);
            mix-blend-mode: overlay;
            animation: syncedOverlay 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite;
        }

        @keyframes syncedBeat {
            0% {
                transform: scale(1);
                opacity: 0.5;
            }

            15% {
                transform: scale(1.03);
                opacity: 0.6;
            }

            30% {
                transform: scale(1);
                opacity: 0.5;
            }

            45% {
                transform: scale(1.2);
                opacity: 0.8;
            }

            60% {
                transform: scale(1);
                opacity: 0.5;
            }
        }

        @keyframes syncedOverlay {
            0% {
                opacity: 0;
            }

            45% {
                opacity: 0.4;
            }

            100% {
                opacity: 0;
            }
        }

        @keyframes auroraMove {

            100% {
                transform: scale(1);
                opacity: 0.6;
            }
        }

        /* --- Layout & Container --- */
        .shorts-container {
            height: 100%;
            width: 100%;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
            -ms-overflow-style: none;
            scrollbar-width: none;
            position: relative;
            z-index: 10;
        }

        .shorts-container::-webkit-scrollbar {
            display: none;
        }

        /* --- Saved Bar (Vibrant Fun AI Theme) --- */
        .saved-bar {
            position: fixed;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 260px;
            max-height: 85%;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 50;
            overflow-y: auto;
            scrollbar-width: none;
            background: linear-gradient(-45deg, rgba(82, 33, 209, 0.7), rgba(220, 31, 255, 0.6), rgba(0, 212, 255, 0.6), rgba(255, 102, 0, 0.5));
            background-size: 400% 400%;
            animation: vibrantMove 10s ease infinite;
            backdrop-filter: blur(20px);
            padding: 18px;
            border-radius: 28px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.6), inset 0 0 30px rgba(255, 255, 255, 0.1);
        }

        .saved-bar::-webkit-scrollbar {
            display: none;
        }

        @keyframes vibrantMove {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .saved-bar-header {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 3px;
            color: #fff;
            margin-bottom: 8px;
            padding-left: 5px;
            font-weight: 900;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .saved-bar-header::before {
            content: '‚ú®';
            font-size: 16px;
        }

        .saved-item {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 24px;
            display: flex;
            align-items: center;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            flex-shrink: 0;
            position: relative;
            backdrop-filter: blur(5px);
        }

        .saved-item:hover {
            transform: translateX(5px) scale(1.02);
            background: rgba(255, 255, 255, 0.25);
            border-color: #fff;
        }

        .saved-item img {
            width: 48px;
            height: 48px;
            object-fit: cover;
            border-radius: 12px;
            margin-right: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }



        .saved-item-title {
            font-size: 13px;
            color: #fff;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            flex-grow: 1;
            padding-right: 20px;
            /* More space for remove button */
            text-align: left;
        }

        .saved-remove {
            position: absolute;
            right: -5px;
            top: -5px;
            color: #fff;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #ff3b3b;
            border-radius: 50%;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.4);
            border: 2px solid #fff;
            z-index: 10;
        }

        .saved-remove:hover {
            background: #ff0000;
            transform: scale(1.1);
        }




        /* --- Nav Buttons --- */
        .nav-buttons {
            position: fixed;
            right: 20px;
            /* Adjust to stay at edge or follow rec-bar */
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 100;
        }

        @media (min-width: 1401px) {
            .nav-buttons {
                right: max(20px, calc(50% - 280px));
            }
        }


        .nav-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            /* Subtle default */
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
            transform: scale(1.05);
        }

        /* Removed individual backgrounds to keep it subtle */

        /* Show color and pop only on click */
        #btnUp:active {
            background: linear-gradient(-45deg, #00d4ff, #8250ff);
            transform: scale(1.3);
            /* Pop effect */
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.6);
        }

        #btnDown:active {
            background: linear-gradient(-45deg, #dc1fff, #ff6600);
            transform: scale(1.3);
            /* Pop effect */
            box-shadow: 0 0 20px rgba(220, 31, 255, 0.6);
        }

        .nav-btn:active {
            filter: brightness(1.3);
        }

        .nav-btn.hidden {
            opacity: 0;
            visibility: hidden;
            /* Absolute hiding */
            pointer-events: none;
            transform: scale(0.5) translateY(20px);
        }

        .nav-btn svg {
            width: 26px;
            height: 26px;
            fill: white;
            filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.5));
        }

        /* --- Video Item --- */
        .short-item {
            height: 100%;
            width: 100%;
            scroll-snap-align: start;
            scroll-snap-stop: always;
            position: relative;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            /* Triple-Lock Clipping */
            border-radius: 44px;
            overflow: hidden !important;
            -webkit-mask-image: -webkit-radial-gradient(white, black);
            mask-image: radial-gradient(white, black);
            clip-path: inset(0 round 44px);
            isolation: isolate;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            -webkit-transform: translate3d(0, 0, 0);
            transform: translate3d(0, 0, 0);
        }

        video {
            height: 100%;
            width: 100%;
            object-fit: cover;
            border-radius: 44px;
            /* Aggressive internal clipping */
            overflow: hidden;
            -webkit-mask-image: -webkit-radial-gradient(white, black);
            mask-image: radial-gradient(white, black);
            clip-path: inset(0 round 44px);
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
        }

        /* --- Overlay --- */
        .overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.95) 0%, rgba(0, 0, 0, 0.6) 40%, transparent 100%);
            padding: 80px 20px 100px 20px;
            /* Increased bottom padding for badge space */
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }

        .overlay-content {
            max-width: 600px;
            margin: 0 auto;
            pointer-events: auto;
            width: 100%;
        }

        .product-title {
            font-size: 1.25rem;
            font-weight: 800;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 1);
            color: #fff;
        }

        .product-desc {
            font-size: 0.95rem;
            color: #fff;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            opacity: 0.95;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        /* --- Actions --- */
        .actions-row {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .bottom-badges {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            display: flex;
            align-items: center;
            gap: 10px;
            pointer-events: auto;
        }

        .safety-badge,
        .fb-follow-btn-inline {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 5px 12px;
            background: rgba(0, 10, 20, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 50px;
            font-size: 0.68rem;
            color: #b0bec5;
            font-weight: 500;
            backdrop-filter: blur(8px);
            opacity: 0.85;
            transition: all 0.3s ease;
            white-space: nowrap;
            text-decoration: none;
        }

        .fb-follow-btn-inline {
            background: rgba(24, 119, 242, 0.25);
            border-color: rgba(24, 119, 242, 0.4);
            color: #fff;
        }

        .safety-badge:hover,
        .fb-follow-btn-inline:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .fb-follow-btn-inline:hover {
            background: rgba(24, 119, 242, 0.5);
        }

        .safety-badge svg,
        .fb-follow-btn-inline svg {
            width: 13px;
            height: 13px;
        }

        .safety-badge svg {
            fill: #40c4ff;
        }

        .fb-follow-btn-inline svg {
            fill: #fff;
        }

        @keyframes fadeInSafe {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 0.85;
                transform: translateY(0);
            }
        }

        /* Neon Progress Bar */
        .progress-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(0, 0, 0, 0.3);
            z-index: 30;
            pointer-events: none;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00f2ff, #bc13fe);
            width: 0%;
            box-shadow: 0 0 10px #00f2ff, 0 0 20px #bc13fe;
            border-radius: 0 4px 4px 0;
            transition: width 0.1s linear;
        }

        .price-tag {
            font-size: 1.5rem;
            font-weight: 800;
            color: #2ecc71;
            margin-right: 12px;
            white-space: nowrap;
            position: relative;
            display: inline-block;
            user-select: none;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
        }

        .price-tag::after {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 0;
            height: 3px;
            background: #ff4d4d;
            transform: translateY(-50%) rotate(-5deg);
            box-shadow: 0 0 5px rgba(255, 77, 77, 0.8);
            animation: priceStrike 2s infinite ease-in-out;
        }

        @keyframes priceStrike {
            0% {
                width: 0;
                left: 0;
            }

            40% {
                width: 110%;
                left: -5%;
            }

            70% {
                width: 110%;
                left: -5%;
                opacity: 1;
            }

            100% {
                width: 110%;
                left: -5%;
                opacity: 0;
            }
        }

        .buy-btn {
            background: linear-gradient(90deg, #ff3d00, #ff9100, #ff3d00);
            background-size: 200% 100%;
            color: white;
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 32px;
            font-weight: 800;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
            box-shadow: 0 4px 25px rgba(255, 61, 0, 0.5);
            flex-grow: 1;
            justify-content: center;
            border: 2px solid rgba(255, 255, 255, 0.4);
            animation: pulseBtn 2s infinite, bgFlow 3s linear infinite;
            white-space: nowrap;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 5;
        }

        /* Shine Effect */
        .buy-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
            transform: skewX(-20deg);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% {
                left: -100%;
            }

            20% {
                left: 100%;
            }

            100% {
                left: 100%;
            }
        }

        .buy-btn:hover {
            transform: scale(1.15) !important;
            box-shadow: 0 10px 40px rgba(255, 61, 0, 0.8);
            z-index: 10;
        }

        /* Party Dots Background on Hover */
        .buy-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(#fff 20%, transparent 20%),
                radial-gradient(#ffeb3b 20%, transparent 20%);
            background-position: 0 0, 5px 5px;
            background-size: 10px 10px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            mix-blend-mode: overlay;
        }

        .buy-btn:hover::after {
            opacity: 0.8;
            animation: partyDots 0.4s linear infinite;
            background-image:
                radial-gradient(#fff 30%, transparent 30%),
                radial-gradient(#ffff00 30%, transparent 30%);
        }

        @keyframes partyDots {
            0% {
                background-position: 0 0, 5px 5px;
            }

            100% {
                background-position: 20px 20px, 25px 25px;
            }
        }

        @keyframes bgFlow {
            0% {
                background-position: 100% 0;
            }

            100% {
                background-position: -100% 0;
            }
        }

        @keyframes pulseBtn {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 61, 0, 0.7);
            }

            70% {
                box-shadow: 0 0 0 15px rgba(255, 61, 0, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(255, 61, 0, 0);
            }
        }

        .fomo-text {
            display: block;
            font-size: 0.75rem;
            color: #ffeb3b;
            margin-bottom: 4px;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
            animation: blink 2s infinite;
        }

        @keyframes blink {
            50% {
                opacity: 0.7;
            }
        }

        .pointing-finger {
            font-size: 1.4rem;
            animation: pointRight 0.8s ease-in-out infinite alternate;
            filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.5));
        }

        @keyframes pointRight {
            from {
                transform: translateX(-5px);
            }

            to {
                transform: translateX(5px);
            }
        }

        .inline-btn.btn-share svg {
            fill: rgba(255, 255, 255, 0.4);
        }

        .inline-btn.btn-share:hover svg {
            fill: #00d4ff;
        }

        .share-toast {
            position: fixed;
            top: 100px;
            /* Below search bar */
            left: 50%;
            transform: translateX(-50%);
            background: #00d4ff;
            color: #000;
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            display: none;
            animation: toastFade 2s forwards;
        }

        @keyframes toastFade {
            0% {
                opacity: 0;
                transform: translate(-50%, -20px);
            }

            20% {
                opacity: 1;
                transform: translate(-50%, 0);
            }

            80% {
                opacity: 1;
                transform: translate(-50%, 0);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -20px);
            }
        }

        .inline-btn {
            width: 50px;
            height: 50px;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.2s;
            flex-shrink: 0;
        }

        .inline-btn:active {
            transform: scale(0.9);
        }

        .inline-btn svg {
            fill: rgba(255, 77, 77, 0.35);
            transition: all 0.3s ease;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .inline-btn:hover svg {
            fill: rgba(255, 77, 77, 0.8);
            transform: scale(1.15);
        }

        .inline-btn.saved svg {
            fill: #ff0000 !important;
            filter: drop-shadow(0 0 8px rgba(255, 0, 0, 0.6));
            animation: heartPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes syncedBeat {
            0% {
                transform: scale(1);
                opacity: 0.5;
            }

            15% {
                transform: scale(1.05);
                opacity: 0.55;
            }

            /* Lub */
            25% {
                transform: scale(1);
                opacity: 0.5;
            }

            45% {
                transform: scale(1.35);
                opacity: 0.75;
            }

            /* DUB (BIG BEAT) */
            60% {
                transform: scale(1);
                opacity: 0.5;
            }

            100% {
                transform: scale(1);
                opacity: 0.5;
            }
        }

        @keyframes syncedOverlay {
            0% {
                opacity: 0;
                transform: scale(1);
            }

            15% {
                opacity: 0.15;
                transform: scale(1.05);
            }

            /* Lub */
            25% {
                opacity: 0;
                transform: scale(1);
            }

            45% {
                opacity: 0.4;
                transform: scale(1.3);
            }

            /* DUB (FLASH) */
            60% {
                opacity: 0;
                transform: scale(1);
            }

            100% {
                opacity: 0;
            }
        }

        .inline-btn.btn-mute {
            width: 64px;
            /* Even bigger */
            height: 64px;
        }

        .inline-btn img {
            width: 42px;
            /* Bigger Icon */
            height: 42px;
            transition: 0.2s;
        }

        @keyframes heartPop {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.4);
            }

            100% {
                transform: scale(1);
            }
        }

        /* Desktop Layout Fixes */
        @media (min-width: 1100px) {
            video {
                width: 100%;
                max-width: 440px;
            }

            .shorts-container {
                width: 100%;
                max-width: 440px;
                margin: 0 auto;
                background: #111;
                border-radius: 40px;
                box-shadow: 0 0 60px rgba(0, 0, 0, 0.9);
            }

            .overlay,
            .search-container {
                max-width: 440px;
                left: 50%;
                transform: translateX(-50%);
            }

            .nav-buttons {
                right: max(20px, calc(50% - 280px));
            }

            .saved-bar {
                left: max(20px, calc(50% - 540px));
                width: 260px;
            }
        }

        @media (max-width: 1099px) {
            .saved-bar {
                left: 10px;
                width: 55px;
                padding: 5px;
                border-radius: 12px;
                background: rgba(15, 5, 30, 0.8);
            }

            .saved-bar .saved-item-title,
            .saved-bar .saved-bar-header,
            .saved-bar .saved-remove {
                display: none;
            }

            .saved-bar .saved-item {
                padding: 3px;
                justify-content: center;
            }

            /* Note: .saved-item img styling removed as requested in text-only update */

            .saved-bar:hover {
                width: 260px;
                padding: 18px;
                border-radius: 28px;
            }

            .saved-bar:hover .saved-item-title,
            .saved-bar:hover .saved-bar-header,
            .saved-bar:hover .saved-remove {
                display: flex;
            }

            .saved-bar:hover .saved-item {
                justify-content: flex-start;
                padding: 12px;
            }
        }

        /* --- Search Bar (Top) --- */
        .search-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 999;
            /* Ensure on top */
            width: 80%;
            max-width: 400px;
        }

        .search-input {
            width: 100%;
            padding: 12px 25px;
            border-radius: 32px;
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(255, 255, 255, 0.4);
            color: white;
            font-size: 16px;
            font-weight: 600;
            backdrop-filter: blur(15px);
            text-align: center;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
            flex-direction: column;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #ee4d2d;
            border-top: 4px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        /* --- Double Tap Heart Animation --- */
        .heart-pop {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            z-index: 100;
            pointer-events: none;
            filter: drop-shadow(0 0 20px rgba(255, 0, 0, 0.8));
        }

        .heart-pop.animate {
            animation: heartShoot 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes heartShoot {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }

            30% {
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 1;
            }

            100% {
                transform: translate(-50%, -150%) scale(1);
                opacity: 0;
            }
        }

        /* --- Particle Canvas --- */
        #particleCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            pointer-events: none;
        }

        /* --- AI Assistant (‡∏ô‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏à‡πâ‡∏≤‡∏á) --- */
        .ai-assistant-wrap {
            position: fixed;
            bottom: 120px;
            /* Near the buy button row */
            left: 50%;
            transform: translateX(110px) translateY(20px);
            /* Move right of center */
            z-index: 200;
            display: flex;
            flex-direction: row-reverse;
            /* Avatar on the right, bubble on the left */
            align-items: flex-end;
            gap: 10px;
            pointer-events: none;
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* Adjust for Mobile */
        @media (max-width: 600px) {
            .ai-assistant-wrap {
                left: auto;
                right: 10px;
                transform: translateX(0) translateY(20px);
            }
        }

        .ai-assistant-wrap.visible {
            opacity: 1;
            transform: translateX(110px) translateY(0);
        }

        @media (max-width: 600px) {
            .ai-assistant-wrap.visible {
                transform: translateX(0) translateY(0);
            }
        }

        .ai-bubble {
            background: rgba(255, 255, 255, 0.98);
            color: #333;
            padding: 10px 15px;
            border-radius: 20px 20px 0 20px;
            font-size: 13px;
            font-weight: 700;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            position: relative;
            max-width: 160px;
            line-height: 1.4;
            border: 2px solid #ee4d2d;
            text-align: center;
        }

        .ai-avatar {
            width: 50px;
            height: 50px;
            background: #fff;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid #ee4d2d;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            flex-shrink: 0;
            animation: bounceIn 1s infinite alternate;
        }

        .ai-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        @keyframes bounceIn {
            from {
                transform: translateY(0);
            }

            to {
                transform: translateY(-5px);
            }
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Mute Button Animation & Tooltip */
        .inline-btn.btn-mute {
            position: relative;
        }

        .bouncing-mute {
            animation: bounceMute 2s infinite;
        }

        @keyframes bounceMute {

            0%,
            20%,
            50%,
            80%,
            100% {
                transform: scale(1);
            }

            40% {
                transform: scale(1.2) rotate(-10deg);
            }

            60% {
                transform: scale(1.1) rotate(10deg);
            }
        }

        .mute-tooltip {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            color: #fff;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            animation: floatTooltip 1.5s infinite ease-in-out;
            pointer-events: none;
            z-index: 200;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .mute-tooltip::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid rgba(0, 0, 0, 0.6);
        }

        @keyframes floatTooltip {

            0%,
            100% {
                transform: translateX(-50%) translateY(0);
            }

            50% {
                transform: translateX(-50%) translateY(-6px);
            }
        }
    </style>
</head>

<body>
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <div class="search-container">
        <input type="text" class="search-input" id="searchInput" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..."
            oninput="handleSearch(this.value)">
    </div>

    <div class="saved-bar" id="savedBar"></div>
    <div id="shareToast" class="share-toast">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! üîó</div>


    <div class="nav-buttons">
        <div class="nav-btn" id="btnUp" onclick="scrollSlide(-1)">
            <svg viewBox="0 0 24 24">
                <path d="M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z" />
            </svg>
        </div>
        <div class="nav-btn" id="btnDown" onclick="scrollSlide(1)">
            <svg viewBox="0 0 24 24">
                <path d="M7.41,8.59L12,13.17L16.59,8.59L18,10L12,16L6,10L7.41,8.59Z" />
            </svg>
        </div>
    </div>


    <div class="shorts-container" id="container"></div>

    <!-- Particle Canvas -->
    <canvas id="particleCanvas"></canvas>

    <!-- AI Assistant -->
    <div class="ai-assistant-wrap" id="aiAssistant">
        <div class="ai-avatar">
            <img src="https://cdn-icons-png.flaticon.com/128/8417/8417163.png" alt="‡∏ô‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏à‡πâ‡∏≤‡∏á">
        </div>
        <div class="ai-bubble" id="aiMsg">‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡∏´‡∏ô‡∏π‡πÉ‡∏ä‡πâ‡πÄ‡∏≠‡∏á ‡∏î‡∏µ‡∏à‡∏£‡∏¥‡∏á‡∏û‡∏µ‡πà!</div>
    </div>

    <script>
        let allProducts = [];
        let displayProducts = [];
        let savedList = [];
        try {
            savedList = JSON.parse(localStorage.getItem('shopeeShortsSaved')) || [];
        } catch (e) { savedList = []; }
        let isMuted = true;
        let userInteracted = false; // Require interaction before auto-unmute
        let isShopping = false; // Prevent autoplay when shopping
        let observer;

        // Capture first interaction to allow auto-audio
        const setInteracted = () => { userInteracted = true; };
        document.addEventListener('click', setInteracted, { capture: true });
        document.addEventListener('keydown', setInteracted, { capture: true });
        document.addEventListener('touchstart', setInteracted, { capture: true });

        const ICON_HEART = '<path d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z"/>';

        async function init() {
            renderSavedBar(); // Render immediately
            try {
                // Persistent Session Check
                const sessionData = sessionStorage.getItem('shopeeShortsSession');
                const urlParams = new URLSearchParams(window.location.search);

                // Support ?v=ID, ?id=ID, ?q=KEYWORD
                let targetId = urlParams.get('v') || urlParams.get('id');
                let keyword = urlParams.get('q');

                // Legacy fallback support (e.g. ?12345)
                if (!targetId && !keyword) {
                    const raw = window.location.search.substring(1);
                    if (/^\d+$/.test(raw)) targetId = raw;
                }

                if (sessionData && !keyword && !targetId) {
                    allProducts = JSON.parse(sessionData);
                } else {
                    // New: Fetch from Supabase
                    const SUPABASE_URL = 'https://jbbirnklofoscfhpedes.supabase.co';
                    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpiYmlybmtsb2Zvc2NmaHBlZGVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3Mzk0MjcsImV4cCI6MjA4NDMxNTQyN30.oboZnO28wZDxFTkDfId5ZhAdIsAZXcs9So1ZcUtfgtE';

                    const resp = await fetch(`${SUPABASE_URL}/rest/v1/products?select=*&order=created_at.desc&limit=1000`, {
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`
                        }
                    });

                    if (!resp.ok) throw new Error('Load failed');
                    let rawData = await resp.json();

                    allProducts = rawData.filter(p => p.id && p.video).map(p => ({
                        id: String(p.id),
                        url: p.video,
                        title: (p.tag && p.tag[0]) ? p.tag[0] : '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥',
                        desc: (p.data_shopee) ? p.data_shopee.slice(0, 3).join(' | ') : '',
                        link: p.link_shopee || '#',
                        price: p.price || '',
                        image: (() => {
                            let raw = p.image || p.image_url || p.images || p.img || p.picture || p.cover;
                            if (Array.isArray(raw)) return raw[0];
                            if (typeof raw === 'string') {
                                if (raw.startsWith('[')) {
                                    try { return JSON.parse(raw.replace(/'/g, '"'))[0]; } catch (e) { }
                                }
                                if (raw.includes(',')) return raw.split(',')[0].trim();
                                return raw;
                            }
                            return null;
                        })()
                    }));
                    if (!keyword && !targetId) allProducts.sort(() => 0.5 - Math.random());
                    sessionStorage.setItem('shopeeShortsSession', JSON.stringify(allProducts));
                }

                if (keyword) {
                    const decodedKey = decodeURIComponent(keyword).trim();
                    document.getElementById('searchInput').value = decodedKey;

                    // Smart Routing: Filter Playlist to MATCH keyword only
                    const lowerKey = decodedKey.toLowerCase();
                    const filtered = allProducts.filter(p =>
                        p.title.toLowerCase().includes(lowerKey) ||
                        p.desc.toLowerCase().includes(lowerKey)
                    );

                    if (filtered.length > 0) {
                        displayProducts = filtered;
                        // Shuffle slightly for freshness, but keep relevance
                        displayProducts.sort(() => 0.5 - Math.random());
                    } else {
                        // Fallback if not found
                        displayProducts = [...allProducts].sort(() => 0.5 - Math.random());
                        window.isShowingSuggestions = true;
                    }
                } else {
                    displayProducts = [...allProducts]; // Default random or sorted
                }

                renderList();
                renderSavedBar(); // Re-render to update images from fetched data







                if (!keyword && targetId) {
                    // Auto-save logic (User Request)
                    const targetProd = allProducts.find(p => String(p.id) === String(targetId));
                    if (targetProd) {
                        const existingIdx = savedList.findIndex(x => String(x.id) === String(targetId));
                        if (existingIdx === -1) {
                            if (savedList.length >= 20) savedList.shift();
                            savedList.push({ id: String(targetId), title: targetProd.title, image: targetProd.image });
                            localStorage.setItem('shopeeShortsSaved', JSON.stringify(savedList));
                            renderSavedBar();
                        }
                    }

                    setTimeout(() => {
                        const el = document.getElementById('product-' + targetId);
                        if (el) {
                            el.scrollIntoView({ behavior: 'instant' });
                            setTimeout(updateNavState, 150);
                        }
                    }, 100);
                } else if (keyword && displayProducts.length > 0) {
                    // Auto-save First Result for Search (User Request)
                    const firstP = displayProducts[0];
                    const existingIdx = savedList.findIndex(x => String(firstP.id) === String(firstP.id));
                    if (existingIdx === -1) {
                        if (savedList.length >= 20) savedList.shift();
                        savedList.push({ id: String(firstP.id), title: firstP.title, image: firstP.image });
                        localStorage.setItem('shopeeShortsSaved', JSON.stringify(savedList));
                        renderSavedBar();
                    }
                    setTimeout(updateNavState, 150);
                } else {
                    setTimeout(updateNavState, 150);
                }

                document.getElementById('loading').style.display = 'none';
                // renderSavedBar(); // Moved to top of init for immediate display

            } catch (e) {
                document.getElementById('loading').innerHTML = `<div style="color:red">${e.message}</div>`;
            }
        }

        function filterProducts(keyword) {
            if (!keyword) {
                displayProducts = [...allProducts];
                window.isShowingSuggestions = false;
                document.title = "üéûÔ∏è ‡∏î‡∏π‡∏Ñ‡∏•‡∏¥‡∏õ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà";
            } else {
                const lower = keyword.toLowerCase();
                document.title = `‡∏£‡∏ß‡∏°‡∏£‡∏µ‡∏ß‡∏¥‡∏ß: ${keyword} | ‡∏ô‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏à‡πâ‡∏≤‡∏á`;
                const keywords = lower.split(/\s+/).filter(k => k.length > 0);
                let scored = allProducts.map(p => {
                    let score = 0;
                    const title = p.title.toLowerCase();
                    const desc = p.desc.toLowerCase();
                    if (title.includes(lower)) score += 500;
                    keywords.forEach(k => {
                        if (title.includes(k)) score += 100;
                        if (desc.includes(k)) score += 20;
                    });
                    return { ...p, score };
                }).filter(p => p.score > 0);

                scored.sort((a, b) => b.score - a.score);
                if (scored.length === 0) {
                    window.isShowingSuggestions = true;
                    displayProducts = [...allProducts].sort(() => 0.5 - Math.random()).slice(0, 15);
                } else {
                    window.isShowingSuggestions = false;
                    displayProducts = scored;
                }
            }
            renderList();
        }

        function handleSearch(val) { filterProducts(val); }

        function renderList() {
            const container = document.getElementById('container');
            container.innerHTML = '';
            // If RecBar exists, make sure to hide if suggestions shown? No, user wants it back.
            // renderRecBar(); // Can be called here too if filtering changes recs

            if (window.isShowingSuggestions) {
                const msg = document.createElement('div');
                msg.style.cssText = "position:fixed; top:85px; left:50%; transform:translateX(-50%); z-index:110; background:rgba(238,77,45,0.95); padding:8px 24px; border-radius:30px; font-size:13px; font-weight:bold; backdrop-filter:blur(5px); box-shadow:0 4px 15px rgba(0,0,0,0.4); border:1px solid rgba(255,255,255,0.2); color:#fff;";
                msg.innerHTML = "‚ú® ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡πÅ‡∏ï‡πà‡∏â‡∏±‡∏ô‡∏Ç‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏¥‡πà‡∏á‡∏ô‡∏µ‡πâ‡πÅ‡∏ó‡∏ô!";
                container.appendChild(msg);
            }
            displayProducts.forEach(v => appendVideo(v));
            setupObserver();
            updateAllMuteIcons();
            updateNavState();

        }

        function appendVideo(v) {
            const container = document.getElementById('container');
            const div = document.createElement('div');
            div.className = 'short-item';
            div.id = 'product-' + v.id;
            div.setAttribute('data-id', v.id);

            const isSaved = savedList.some(item => item.id === v.id);
            const formattedPrice = v.price ? parseInt(v.price).toLocaleString() : '';
            const viewers = Math.floor(Math.random() * (450 - 120 + 1)) + 120; // Random 120-450

            // Use data-src for Lazy Loading (Poster removed per request)
            div.innerHTML = `
            <video class="short-video" data-src="${v.url}" loop playsinline preload="none" ${isMuted ? 'muted' : ''}></video>
            <div class="overlay">
                <div class="overlay-content">
                    <div class="product-title">${v.title}</div>
                    <div class="product-desc">${v.desc}</div>
                    <div class="actions-row">
                        <div class="inline-btn ${isSaved ? 'saved' : ''}" id="btn-save-${v.id}">
                            <svg viewBox="0 0 24 24">${ICON_HEART}</svg>
                        </div>
                        <div style="display:flex; flex-direction:column; min-width:80px;">
                             <span class="fomo-text">üî• ${viewers} ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏π</span>
                             ${formattedPrice ? `<div class="price-tag">‡∏ø${formattedPrice}</div>` : ''}
                        </div>
                        <a href="${v.link}" class="buy-btn" target="_blank" onclick="pauseAll()" onmousemove="startCheer(event)" onmouseleave="stopCheer()">
                            <span class="pointing-finger">üëâ</span>
                            <span>‡πÄ‡∏ä‡πá‡∏Ñ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</span>
                        </a>
                        <div class="inline-btn btn-share" onclick="copyShareLink('${v.id}')">
                           <svg viewBox="0 0 24 24" width="24" height="24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92c0-1.61-1.31-2.92-2.92-2.92z"/></svg>
                        </div>
                        <div class="inline-btn btn-mute" onclick="toggleMute()">
                           <div class="mute-icon-wrap"></div>
                        </div>
                    </div>
                </div>
                <!-- Bottom Badges Container -->
                <div class="bottom-badges">
                    <div class="safety-badge">
                        <svg viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/></svg>
                        <span>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£ Shopee</span>
                    </div>
                    <a href="https://www.facebook.com/nongrabjang" target="_blank" class="fb-follow-btn-inline">
                        <svg viewBox="0 0 24 24"><path d="M12 2.04C6.5 2.04 2 6.53 2 12.06C2 17.06 5.66 21.21 10.44 21.96V14.96H7.9V12.06H10.44V9.85C10.44 7.34 11.93 5.96 14.15 5.96C15.21 5.96 16.12 6.04 16.12 6.04V8.51H15.01C13.77 8.51 13.38 9.28 13.38 10.07V12.06H16.16L15.72 14.96H13.38V21.96C18.16 21.21 21.82 17.06 21.82 12.06C21.82 6.53 17.32 2.04 12 2.04Z"/></svg>
                        <span>‡∏ô‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏à‡πâ‡∏≤‡∏á</span>
                    </a>
                </div>
                <!-- Neon Progress Bar -->
                <div class="progress-container">
                    <div class="progress-bar"></div>
                </div>
                <!-- 3D Heart Overlay -->
                <div class="heart-pop">
                    <svg width="100" height="100" viewBox="0 0 24 24" fill="#ff4d4d">
                        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                    </svg>
                </div>
            </div>`;

            // Onclick handler attached to video element later after creation
            const vidEl = div.querySelector('video');
            const pBar = div.querySelector('.progress-bar');
            const hPop = div.querySelector('.heart-pop');

            // Double Tap Detection
            let lastTap = 0;
            vidEl.addEventListener('touchstart', (e) => {
                const now = Date.now();
                if (now - lastTap < 300) {
                    handleDoubleTap(v);
                }
                lastTap = now;
            });
            // Also for Desktop
            vidEl.addEventListener('dblclick', () => handleDoubleTap(v));

            function handleDoubleTap(v) {
                // Heart Animation
                hPop.classList.remove('animate');
                void hPop.offsetWidth; // Trigger reflow
                hPop.classList.add('animate');

                // Save if not already saved
                const isSaved = savedList.some(item => item.id === v.id);
                if (!isSaved) {
                    toggleSave(v.id, v.title);
                }
            }

            // Progress Bar Update
            vidEl.addEventListener('timeupdate', () => {
                if (vidEl.duration) {
                    const pct = (vidEl.currentTime / vidEl.duration) * 100;
                    pBar.style.width = pct + '%';
                }
            });
            vidEl.onclick = function () {
                if (this.paused) {
                    loadVideo(this);
                    this.play();
                } else {
                    this.pause();
                }
            };

            // Safe event listener for Save button
            const saveBtn = div.querySelector(`#btn-save-${v.id}`);
            if (saveBtn) saveBtn.onclick = (e) => toggleSave(v.id, v.title, e);

            container.appendChild(div);
        }

        function setupObserver() {
            if (window.observer) window.observer.disconnect();

            const options = { root: document.getElementById('container'), threshold: 0.6 };
            window.observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const video = entry.target.querySelector('video');
                    if (!video) return;

                    if (entry.isIntersecting) {
                        // Load and Play Current

                        // IF SHOPPING, DO NOT PLAY
                        if (window.isShopping) {
                            // Just load it but don't play
                            loadVideo(video);
                            video.pause();
                            return;
                        }

                        if (userInteracted) {
                            // User has clicked/tapped before -> We can force Unmute
                            isMuted = false;
                            video.muted = false;
                            video.volume = 1.0;
                        } else {
                            // No interaction yet -> Browser blocks Audio -> Keep Muted & Show Icon
                            isMuted = true;
                            video.muted = true;
                        }
                        updateAllMuteIcons();

                        loadVideo(video);
                        video.play().catch(() => {
                            // If autoplay blocked, keep muted but try to play
                            video.muted = true;
                            video.play();
                        });


                        // Preload Neighbors (Prev + Next)
                        const parent = entry.target;
                        const prev = parent.previousElementSibling;
                        const next = parent.nextElementSibling;
                        if (prev) loadVideo(prev.querySelector('video'));
                        if (next) loadVideo(next.querySelector('video'));

                        // Cleanup Distant Videos
                        cleanupVideos(parent);

                        const pid = entry.target.getAttribute('data-id');
                        history.replaceState(null, '', '?v=' + pid);
                        const prod = allProducts.find(p => p.id === pid);
                        if (prod) document.title = prod.title + " - ‡∏ô‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏à‡πâ‡∏≤‡∏á";

                    } else {
                        video.pause();
                        video.currentTime = 0;
                    }
                });
            }, options);

            document.querySelectorAll('.short-item').forEach(item => window.observer.observe(item));
        }

        function loadVideo(v) {
            if (v.getAttribute('src')) return true; // Already loaded
            const src = v.getAttribute('data-src');
            if (src) {
                v.src = src;
                v.load();
                return true;
            }
            return false;
        }

        function cleanupVideos(currentItem) {
            const allItems = Array.from(document.querySelectorAll('.short-item'));
            const currentIndex = allItems.indexOf(currentItem);

            allItems.forEach((item, index) => {
                // Keep only range of [current-2, current+2] loaded
                if (Math.abs(index - currentIndex) > 2) {
                    const v = item.querySelector('video');
                    if (v && v.getAttribute('src')) {
                        v.removeAttribute('src'); // Unload source
                        v.load(); // Reset player
                    }
                }
            });
        }

        function scrollSlide(dir) {
            // Auto Unmute on navigation click
            if (isMuted) {
                isMuted = false;
                document.querySelectorAll('video').forEach(v => v.muted = false);
                updateAllMuteIcons();
            }

            const h = window.innerHeight;
            document.getElementById('container').scrollBy({ top: dir * h, behavior: 'smooth' });
        }

        // Global scroll handler to support wheel anywhere
        window.addEventListener('wheel', (e) => {
            const container = document.getElementById('container');
            // Check if scrolling inside saved-bar or rec-bar, ignore global scroll
            if (e.target.closest('.saved-bar') || e.target.closest('.rec-bar')) return;

            e.preventDefault();
            container.scrollBy({ top: e.deltaY, behavior: 'auto' });
        }, { passive: false });
        function updateNavState() {
            const container = document.getElementById('container');
            const btnUp = document.getElementById('btnUp');
            const btnDown = document.getElementById('btnDown');
            if (!btnUp || !btnDown) return;
            if (container.scrollTop <= 10) btnUp.classList.add('hidden');
            else btnUp.classList.remove('hidden');
            if (container.scrollTop + container.clientHeight >= container.scrollHeight - 10) btnDown.classList.add('hidden');
            else btnDown.classList.remove('hidden');
        }
        document.getElementById('container').addEventListener('scroll', updateNavState);

        function pauseAll() { document.querySelectorAll('video').forEach(v => v.pause()); }

        window.toggleMute = function () {
            userInteracted = true;
            isMuted = !isMuted;
            document.querySelectorAll('video').forEach(v => v.muted = isMuted);
            updateAllMuteIcons();
        };

        function updateAllMuteIcons() {
            const wraps = document.querySelectorAll('.mute-icon-wrap');

            // Toggle Beat Mode on Body
            if (isMuted) {
                document.body.classList.remove('beat-mode');
            } else {
                document.body.classList.add('beat-mode');
            }

            wraps.forEach(wrap => {
                const btn = wrap.parentElement;
                const row = btn.parentElement;
                const shareBtn = row ? row.querySelector('.btn-share') : null;

                if (isMuted) {
                    wrap.innerHTML = `<img src="https://cdn-icons-png.flaticon.com/128/4067/4067572.png">`;

                    // Add Tooltip if not exists
                    if (!btn.querySelector('.mute-tooltip')) {
                        const tt = document.createElement('div');
                        tt.className = 'mute-tooltip';
                        tt.innerHTML = 'üîä ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á!';
                        btn.appendChild(tt);
                    }

                    btn.style.display = 'flex';
                    btn.classList.add('bouncing-mute');
                    if (shareBtn) shareBtn.style.display = 'none';
                } else {
                    wrap.innerHTML = '';
                    const tt = btn.querySelector('.mute-tooltip');
                    if (tt) tt.remove();

                    btn.style.display = 'none';
                    btn.classList.remove('bouncing-mute');
                    if (shareBtn) shareBtn.style.display = 'flex';
                }
            });
        }

        window.toggleSave = function (id, title, e) {
            if (e) e.stopPropagation();
            const idx = savedList.findIndex(x => x.id === id);

            if (idx === -1) {
                // Find product to get image
                const prod = allProducts.find(p => p.id === id);
                const image = prod ? prod.image : null;

                if (savedList.length >= 20) savedList.shift();
                savedList.push({ id, title, image });
                const btn = document.getElementById('btn-save-' + id);
                if (btn) btn.classList.add('saved');
            } else {
                savedList.splice(idx, 1);
                const btn = document.getElementById('btn-save-' + id);
                if (btn) btn.classList.remove('saved');
            }
            localStorage.setItem('shopeeShortsSaved', JSON.stringify(savedList));
            renderSavedBar();
        };

        window.removeSaved = function (e, id) {
            e.stopPropagation();
            savedList = savedList.filter(x => x.id !== id);
            localStorage.setItem('shopeeShortsSaved', JSON.stringify(savedList));
            renderSavedBar();
            const btn = document.getElementById('btn-save-' + id);
            if (btn) btn.classList.remove('saved');
        };

        window.playVideo = function (id) {
            // Hide recommendation bar immediately upon click
            const bar = document.getElementById('recBar');
            if (bar) bar.style.display = 'none';

            const el = document.getElementById('product-' + id);
            if (el) {
                el.scrollIntoView({ behavior: 'smooth' });
            } else {
                window.location.href = '?v=' + id;
            }
        };

        window.copyShareLink = function (id) {
            const url = new URL(window.location.href);
            url.searchParams.delete('q');
            url.searchParams.set('v', id);

            const link = url.toString();
            navigator.clipboard.writeText(link).then(() => {
                const toast = document.getElementById('shareToast');
                toast.style.display = 'block';
                setTimeout(() => { toast.style.display = 'none'; }, 2000);
            });
        };

        window.clickSaved = function (id) {
            // SET SHOPPING MODE
            window.isShopping = true;

            // Try to find the element in the DOM
            let el = document.getElementById('product-' + id);
            const prod = allProducts.find(p => String(p.id) === String(id));

            // If not found in DOM but exists in data, inject it dynamically
            if (!el && prod) {
                appendVideo(prod);
                setupObserver(); // Refresh observer for the new element
                el = document.getElementById('product-' + id);
            }

            if (el) {
                // Smooth scroll to the video
                el.scrollIntoView({ behavior: 'smooth' });

                // Open Shopee link after short delay (to let scroll finish)
                if (prod) {
                    setTimeout(() => {
                        pauseAll();
                        window.open(prod.link, '_blank');

                        // Reset shopping mode after a few seconds so user can resume normally if they come back
                        setTimeout(() => { window.isShopping = false; }, 3000);
                    }, 800);
                } else {
                    window.isShopping = false;
                }
            } else {
                // Fallback only if product completely missing from data
                console.error("Product not found:", id);
                window.isShopping = false;
            }
        };

        function renderSavedBar() {
            const bar = document.getElementById('savedBar');
            if (savedList.length === 0) {
                bar.style.display = 'none';
                bar.innerHTML = '';
                return;
            }
            bar.style.display = 'flex';
            bar.innerHTML = '<div class="saved-bar-header" style="font-size:16px; margin-bottom:5px;">‡∏ä‡∏≠‡∏ö‡∏™‡∏¥‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏°‡∏≤‡∏Å‡πÜ</div>' + savedList.map(item => {
                // Try to find image if missing (compatibility with old saves)
                let imgUrl = item.image;
                if (!imgUrl) {
                    // Fix: Use String(item.id) to ensure match with String(p.id)
                    const prod = allProducts.find(p => String(p.id) === String(item.id));
                    if (prod) {
                        imgUrl = prod.image;
                        // Persist found image back to savedList
                        item.image = imgUrl;
                        try { localStorage.setItem('shopeeShortsSaved', JSON.stringify(savedList)); } catch (e) { }
                    }
                }

                return `
            <div class="saved-item" onclick="clickSaved('${item.id}')">
                ${imgUrl ? `<img src="${imgUrl}" alt="img">` : '<div style="width:40px;height:40px;background:#555;border-radius:8px;margin-right:10px;display:flex;align-items:center;justify-content:center;">üõçÔ∏è</div>'}
                <div class="saved-item-title">${item.title}</div>
                <div class="saved-remove" onclick="removeSaved(event, '${item.id}')">√ó</div>
            </div>`;
            }).join('');
        }




        init();
        // --- Particle Magic Logic ---
        const canvas = document.getElementById('particleCanvas');
        const ctx = canvas.getContext('2d');
        let particles = [];

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        class Particle {
            constructor(x, y, type = 'normal') {
                this.x = x;
                this.y = y;

                if (type === 'scroll') {
                    this.size = Math.random() * 3 + 1; // Smaller
                    this.speedX = Math.random() * 4 - 2;
                    this.speedY = Math.random() * -10 - 4;
                    this.color = `hsl(${Math.random() * 360}, 60%, 75%)`; // Less saturated
                    this.alpha = 0.4; // Dimmer
                    this.decay = 0.015;
                } else if (type === 'cheer') {
                    this.size = Math.random() * 3 + 1.5;
                    this.speedX = Math.random() * 5 - 2.5;
                    this.speedY = Math.random() * -12 - 6; // Slower speed
                    this.color = `hsl(${Math.random() * 60 + 10}, 100%, 75%)`;
                    this.alpha = 0.9;
                    this.decay = 0.025; // Faster decay to stop around midpoint
                } else {
                    this.size = Math.random() * 2 + 1;
                    this.speedX = Math.random() * 2 - 1;
                    this.speedY = Math.random() * -3 - 1;
                    this.color = `hsl(${Math.random() * 60 + 180}, 60%, 70%)`;
                    this.alpha = 0.3;
                    this.decay = 0.005;
                }
            }
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                this.alpha -= (this.decay || 0.01);
            }
            draw() {
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function handleParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < particles.length; i++) {
                particles[i].update();
                particles[i].draw();
                if (particles[i].alpha <= 0) {
                    particles.splice(i, 1);
                    i--;
                }
            }
            requestAnimationFrame(handleParticles);
        }
        handleParticles();

        // --- Cheer Effect (Button Hover) ---
        let cheerInterval;
        window.startCheer = function (e) {
            if (cheerInterval) return; // Prevent multiple intervals

            // Burst immediately huge amount
            for (let i = 0; i < 30; i++) particles.push(new Particle(e.clientX, e.clientY, 'cheer'));

            cheerInterval = setInterval(() => {
                // Spawn wave from bottom
                for (let i = 0; i < 8; i++) {
                    particles.push(new Particle(Math.random() * canvas.width, canvas.height, 'cheer'));
                }
                // Spark from mouse
                if (window.lastMouseX) {
                    for (let k = 0; k < 3; k++) {
                        particles.push(new Particle(window.lastMouseX, window.lastMouseY, 'cheer'));
                    }
                }
            }, 25); // Fast tick
        }

        window.stopCheer = function () {
            clearInterval(cheerInterval);
            cheerInterval = null;
        }

        document.addEventListener('mousemove', (e) => {
            window.lastMouseX = e.clientX;
            window.lastMouseY = e.clientY;
        });

        document.getElementById('container').addEventListener('scroll', () => {
            // Spawn PROMINENT particles during scroll
            for (let i = 0; i < 12; i++) {
                particles.push(new Particle(Math.random() * canvas.width, canvas.height, 'scroll'));
            }
        });

        // --- AI Assistant Logic ---
        const phrases = [
            "‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡∏´‡∏ô‡∏π‡πÉ‡∏ä‡πâ‡πÄ‡∏≠‡∏á ‡∏î‡∏µ‡∏à‡∏£‡∏¥‡∏á‡∏û‡∏µ‡πà!",
            "‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏û‡∏•‡∏≤‡∏î‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏™‡∏µ‡∏¢‡∏î‡∏≤‡∏¢‡πÅ‡∏¢‡πà",
            "‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‡∏£‡∏µ‡∏ö‡∏ï‡∏≥‡πÄ‡∏•‡∏¢!",
            "‡∏Ç‡∏≠‡∏á‡∏°‡∏±‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ô‡∏∞‡∏û‡∏µ‡πà!",
            "‡∏™‡πà‡∏á‡πÑ‡∏ß‡∏°‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ ‡∏´‡∏ô‡∏π‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏¥‡∏£‡πå‡∏°",
            "‡∏Ñ‡∏∏‡πâ‡∏°‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞‡∏à‡πä‡∏∞",
            "‡∏û‡∏µ‡πà‡∏à‡πã‡∏≤... ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏•‡∏î‡πÄ‡∏¢‡∏≠‡∏∞‡∏°‡∏≤‡∏Å‡∏Å‡∏Å",
            "‡∏Å‡∏î‡∏î‡∏π‡∏ï‡∏£‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÄ‡∏•‡∏¢‡∏û‡∏µ‡πà ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏°‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏°‡∏≤‡∏Å",
            "‡∏ä‡∏¥‡πâ‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡∏π‡∏ó‡∏±‡∏Å‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô ‡∏™‡∏ß‡∏¢‡∏à‡∏£‡∏¥‡∏á!",
            "‡πÇ‡∏õ‡∏£‡∏•‡∏±‡∏ö‡∏°‡∏µ‡πÅ‡∏Ñ‡πà‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ‡∏ô‡∏∞‡∏Ñ‡∏∞‡∏û‡∏µ‡πà",
            "‡∏û‡∏µ‡πà‡∏î‡∏π‡∏™‡∏¥... ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏ô‡πà‡∏ô!",
            "‡∏´‡∏ô‡∏π‡∏Ñ‡∏±‡∏î‡∏°‡∏≤‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ô‡πâ‡∏ô‡πÜ ‡πÄ‡∏•‡∏¢‡∏ô‡∏∞",
            "‡∏Ç‡∏≠‡∏á‡πÅ‡∏ó‡πâ‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô ‡∏•‡πâ‡∏≤‡∏ô‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå",
            "‡∏û‡∏µ‡πà‡∏à‡πã‡∏≤... ‡∏ä‡πâ‡∏≤‡∏´‡∏°‡∏î ‡∏≠‡∏î‡∏ô‡∏∞ ‡∏´‡∏ô‡∏π‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞",
            "‡∏à‡∏±‡∏î‡πÄ‡∏•‡∏¢‡∏û‡∏µ‡πà ‡∏™‡∏ß‡∏¢‡∏à‡∏ö‡πÉ‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß!",
            "‡πÉ‡∏™‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏î‡∏π‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô 100% ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏π",
            "‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏ô‡∏î‡∏±‡∏á‡πÜ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞‡∏°‡∏≤‡∏Å‡∏û‡∏µ‡πà",
            "‡∏ñ‡∏π‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡πÑ‡∏õ‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏´‡πâ‡∏≤‡∏á‡∏≠‡∏µ‡∏Å",
            "‡∏á‡∏≤‡∏ô‡∏î‡∏µ ‡∏á‡∏≤‡∏ô‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‡πÑ‡∏°‡πà‡∏Å‡πä‡∏≠‡∏Å‡πÅ‡∏Å‡πä‡∏Å‡∏ô‡∏∞",
            "‡∏û‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏≠‡∏á! ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡∏£‡∏±‡∏Å‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏´‡∏ô‡∏π",
            "‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÄ‡∏Å‡∏¥‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏õ‡πÑ‡∏Å‡∏•‡∏°‡∏≤‡∏Å‡∏û‡∏µ‡πà‡∏à‡πã‡∏≤",
            "‡∏´‡∏ô‡∏π‡πÅ‡∏≠‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡∏¥‡πâ‡∏ô!",
            "‡∏≠‡∏¢‡πà‡∏≤‡∏Ñ‡∏¥‡∏î‡∏ô‡∏≤‡∏ô‡∏û‡∏µ‡πà ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏´‡∏°‡∏î‡∏Å‡πà‡∏≠‡∏ô",
            "‡∏û‡∏µ‡πà‡∏î‡∏π‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ... ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÄ‡∏Ñ‡πâ‡∏≤‡∏î‡∏µ‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏ô‡∏∞",
            "‡∏™‡∏µ‡∏™‡∏±‡∏ô‡∏™‡∏ß‡∏¢‡∏°‡∏≤‡∏Å ‡∏Ç‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏™‡∏ß‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡πÉ‡∏ô‡∏Ñ‡∏•‡∏¥‡∏õ‡∏≠‡∏µ‡∏Å",
            "‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡πÄ‡∏Ñ‡πâ‡∏≤‡∏ñ‡∏π‡∏Å‡πÉ‡∏à‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô",
            "‡πÅ‡∏ü‡∏ô‡∏´‡∏ô‡∏π‡πÄ‡∏´‡πá‡∏ô‡∏¢‡∏±‡∏á‡∏ä‡∏°‡∏ß‡πà‡∏≤‡∏î‡∏µ‡πÄ‡∏•‡∏¢‡∏û‡∏µ‡πà",
            "‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡πÄ‡∏¢‡∏≠‡∏∞‡πÄ‡∏•‡∏¢‡∏û‡∏µ‡πà‡∏Ñ‡∏∏‡πâ‡∏°‡∏™‡∏∏‡∏î‡πÜ",
            "‡∏•‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏ó‡∏≥‡πÑ‡∏°‡∏´‡∏ô‡∏π‡∏ñ‡∏∂‡∏á‡πÄ‡∏ä‡∏µ‡∏¢‡∏£‡πå",
            "‡∏û‡∏µ‡πà‡∏à‡πã‡∏≤‡∏≤‡∏≤ ‡∏Å‡∏î‡πÄ‡∏£‡πá‡∏ß‡∏ß‡∏ß ‡∏Ç‡∏≠‡∏á‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏≠‡∏¢‡∏π‡πà!",
            "‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡πà‡∏ô‡∏Ñ‡∏£‡∏ö ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏°‡∏≤‡∏Å",
            "‡∏ó‡∏ô‡∏ó‡∏≤‡∏ô‡∏°‡∏≤‡∏Å‡∏û‡∏µ‡πà ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏¢‡∏≤‡∏ß‡πÜ ‡πÄ‡∏•‡∏¢",
            "‡πÉ‡∏Ñ‡∏£‡πÜ ‡∏Å‡πá‡∏°‡∏µ‡∏Å‡∏±‡∏ô ‡∏û‡∏µ‡πà‡∏à‡∏∞‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏î‡πâ‡πÑ‡∏á‡πÄ‡∏ô‡∏≠‡∏∞",
            "‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö 1 ‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏¢‡∏ô‡∏∞",
            "‡∏û‡∏µ‡πà... ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏ô‡∏π‡πÉ‡∏´‡πâ 10/10 ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞",
            "‡∏™‡∏±‡πà‡∏á‡πÄ‡∏•‡∏¢‡∏û‡∏µ‡πà ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏´‡∏ô‡∏π‡πÑ‡∏õ‡∏ä‡πà‡∏ß‡∏¢‡∏•‡∏∏‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á",
            "‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‡∏´‡∏ô‡∏π‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö‡πÉ‡∏à",
            "‡∏û‡∏µ‡πà‡∏Ñ‡∏∞... ‡∏ä‡∏¥‡πâ‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏´‡∏ô‡∏π‡πÄ‡∏•‡∏¢‡∏ô‡∏∞!",
            "‡∏î‡∏π‡∏£‡∏≤‡∏Ñ‡∏≤‡∏î‡∏¥‡∏û‡∏µ‡πà ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡πÅ‡∏ü‡πÑ‡∏°‡πà‡∏Å‡∏µ‡πà‡πÅ‡∏Å‡πâ‡∏ß‡πÄ‡∏≠‡∏á",
            "‡∏™‡∏ß‡∏¢‡∏ï‡∏∞‡πÇ‡∏Å‡∏ô! ‡∏à‡∏ô‡∏Ñ‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô",
            "‡∏û‡∏µ‡πà‡∏à‡∏∞‡∏Ç‡∏≤‡∏ß/‡∏™‡∏ß‡∏¢/‡πÄ‡∏ó‡πà ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏±‡∏ô‡∏ï‡∏≤‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏•‡∏¢!",
            "‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‡∏ö‡∏≠‡∏Å‡∏ï‡πà‡∏≠ ‡∏´‡∏ô‡∏π‡πÑ‡∏°‡πà‡∏´‡∏•‡∏≠‡∏Å‡∏û‡∏µ‡πà‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô",
            "‡∏û‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏à‡∏ô‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡∏ä‡∏¥‡πâ‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏î‡πá‡∏î‡∏à‡∏£‡∏¥‡∏á",
            "‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏≠‡∏á‡∏ô‡∏∞‡∏Ñ‡∏∞‡∏û‡∏µ‡πà ‡∏à‡∏±‡∏î‡∏î‡πà‡∏ß‡∏ô‡∏ô‡∏ô!",
            "‡πÅ‡∏û‡πá‡∏Å‡∏Ç‡∏≠‡∏á‡∏°‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏î‡∏µ ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏´‡∏≤‡∏¢‡∏´‡πà‡∏ß‡∏á",
            "‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏µ‡πÜ ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ ‡∏´‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡∏ô‡∏∞",
            "‡∏û‡∏µ‡πà‡∏à‡πã‡∏≤... ‡∏´‡∏ô‡∏π‡∏à‡∏±‡∏î‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏û‡∏µ‡πà‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏•‡∏¢",
            "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡πÉ‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏ö‡∏≤‡∏¢‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡∏à‡πâ‡∏∞",
            "‡∏û‡∏µ‡πà‡∏Ñ‡∏∞ ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏ô‡∏∞",
            "‡∏ô‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏à‡πâ‡∏≤‡∏á‡∏ü‡∏±‡∏ô‡∏ò‡∏á! ‡∏î‡∏µ‡∏ä‡∏±‡∏ß‡∏£‡πå‡∏à‡πâ‡∏≤‡∏û‡∏µ‡πà"
        ];
        const avatars = [
            "https://cdn-icons-png.flaticon.com/128/10851/10851235.png",
            "https://cdn-icons-png.flaticon.com/128/6723/6723246.png",
            "https://cdn-icons-png.flaticon.com/128/10477/10477506.png",
            "https://cdn-icons-png.flaticon.com/128/4138/4138902.png",
            "https://cdn-icons-png.flaticon.com/128/10851/10851314.png",
            "https://cdn-icons-png.flaticon.com/128/10851/10851330.png",
            "https://cdn-icons-png.flaticon.com/128/18404/18404971.png",
            "https://cdn-icons-png.flaticon.com/128/10477/10477511.png",
            "https://cdn-icons-png.flaticon.com/128/1469/1469584.png",
            "https://cdn-icons-png.flaticon.com/128/11035/11035630.png",
            "https://cdn-icons-png.flaticon.com/128/10851/10851216.png",
            "https://cdn-icons-png.flaticon.com/128/8304/8304094.png",
            "https://cdn-icons-png.flaticon.com/128/11052/11052505.png",
            "https://cdn-icons-png.flaticon.com/128/7357/7357207.png",
            "https://cdn-icons-png.flaticon.com/128/3993/3993143.png",
            "https://cdn-icons-png.flaticon.com/128/10851/10851262.png",
            "https://cdn-icons-png.flaticon.com/128/11349/11349015.png"
        ];
        function showAIAssistant() {
            if (isMuted) return; // Only show if sound is ON

            const aiWrap = document.getElementById('aiAssistant');
            const aiMsg = document.getElementById('aiMsg');
            if (!aiWrap || !aiMsg) return;
            const aiImg = aiWrap.querySelector('img');

            const randomPhrase = phrases[Math.floor(Math.random() * phrases.length)];
            const randomAvatar = avatars[Math.floor(Math.random() * avatars.length)];

            aiImg.src = randomAvatar;
            aiMsg.innerText = randomPhrase;
            aiWrap.classList.add('visible');

            setTimeout(() => {
                aiWrap.classList.remove('visible');
            }, 5000); // Show for 5 seconds
        }

        // Show every 15-25 seconds (checks isMuted internally)
        setInterval(() => {
            if (!window.isShopping) showAIAssistant();
        }, 20000);

        // Initial show after 3 seconds
        setTimeout(showAIAssistant, 3000);

    </script>
</body>

</html>